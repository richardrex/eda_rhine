---
title: "Environmental Data Analysis "
author: "Egor Suslin"
date: "20.04.2020"
output: 
  html_document:
    toc: true
    number_sections: true
    theme: united
    pandoc_args: 
      ["--number-sections",
      "--number-offset=1"]
---

```{r, include = FALSE}
library(data.table)
library(ggplot2)
library(dplyr)
library(plotly)
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
getwd()
```

# Exploratory data analysis(EDA)



During our week course of EDA i worked with big amount of data. 
We were provided with a database of the river Rhine.
In this presentation I will show the main data manipulations and some final results of the changes



## Sum of statistics plotted
This table shows a graphs of total statistics of all stations over the period of all data collected, it shows the spread of the data . 



```{r barplot,echo = FALSE, fig.width = 10, fig.height = 6}
runoff_stats <- readRDS("./data/runoff_stats.rds")
runoff_day <- readRDS("./data/runoff_day_raw.rds")
runoff_month <- readRDS("./data/runoff_month.rds")
runoff_stations <- readRDS("./data/runoff_stations_raw.rds")
runoff_stats$median <- runoff_day[,median(value), by = sname][,2]
runoff_stats <- runoff_stats[sname != "REES" & sname != "MAXA" & sname != "DOMA" & sname != "FELS"]
runoff_stats_tidy <- melt(runoff_stats, id.vars = 'sname')
ggplot(runoff_stats_tidy, aes(x = sname, y = value, shape = "cyl", color = "cyl", size = 0.5)) + 
  geom_point(aes(col = variable, shape = variable)) +
   ylab(label = " Daily Runoff") 
```



## Sum of values



```{r runoff_day_raw, echo = FALSE}
runoff_stats <- readRDS("./data/runoff_stats.rds")
runoff_day <- readRDS("./data/runoff_day_raw.rds")
runoff_month <- readRDS("./data/runoff_month.rds")
runoff_stations <- readRDS("./data/runoff_stations_raw.rds")
runoff_stats$median <- runoff_day[,median(value), by = sname][,2]
runoff_stats_tidy <- melt(runoff_stats, id.vars = 'sname', by = sname)
knitr::kable(runoff_stats_tidy, caption = "summary statistics", digits = 0)
```



## Analysis of 3 stations for each month
This plot shows changes in total  runoff during month at different points of altitude along the river, DOMA and BASR are at higher altitudes, while KOEL is at a lower altitude, in the results it is easy to show the greater divergence of the mean at stations with higher altitude,(smaller in summer, greater in winter), this holds true for all stations. in this ploblem we took 3 stations DOMA BASR and KOEL



```{r, echo = FALSE}
runoff_month_key <- readRDS('data/runoff_month_key.rds')
runoff_year_key <- readRDS('data/runoff_year_key.rds')
colset_4 <-  c("#D35C37", "#BF9A77", "#D6C6B9", "#97B8C2")
year_thres <- 2000
runoff_year_key <- runoff_year_key[value >= 0]  
runoff_month_key <- runoff_month_key[value >= 0]  
runoff_year_key[year < year_thres, period := factor('_2000')]
runoff_year_key[year >= year_thres, period := factor('_2000')]
runoff_month_key[year < year_thres, period := factor('_2000')]
runoff_month_key[year >= year_thres, period := factor('_2000')]
ggplot(runoff_month_key, aes(factor(month), value, fill = period)) +
  geom_boxplot() +
  facet_wrap(~sname, scales = 'free_y') +
  scale_fill_manual(values = colset_4[c(4, 1)]) +
  xlab(label = "time period") +
  ylab(label = "Runoff") +
  theme_bw()
```



## Average run off at the same stations 
The same 3 stations that in previous plot. After 2000
We can see little changes between pre and after 2000



```{r, echo=FALSE}
ggplot(runoff_month_key, aes(period, value, fill = period)) +
  geom_boxplot() +
  facet_wrap(~sname, scales = 'free_y') +
  scale_fill_manual(values = colset_4[c(4, 1)]) +
  xlab(label = "time period") +
  ylab(label = "Runoff") +
  theme_bw()
```
